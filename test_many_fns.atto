(* Test many functions with recursive ADT *)

type Template =
  TConst of float
| TVar of string
| TAdd of Template * Template
| TSub of Template * Template
| TMul of Template * Template

structure Test = {
  fun f1 x = x + 1,
  fun f2 x = x + 2,
  fun f3 x = x + 3,

  (* Main function with many cases *)
  fun process (id, tmpl) : (int * Template) -> (int * int) =
    case tmpl of
      Template.TConst r -> (id, 1)
    | Template.TVar v -> (id, 2)
    | Template.TAdd (a, b) ->
        let (id1, c1) = process (id, a) in
        let (id2, c2) = process (id1, b) in
        (id2, c1 + c2)
    | Template.TSub (a, b) ->
        let (id1, c1) = process (id, a) in
        let (id2, c2) = process (id1, b) in
        (id2, c1 - c2)
    | Template.TMul (a, b) ->
        let (id1, c1) = process (id, a) in
        let (id2, c2) = process (id1, b) in
        (id2, c1 * c2)
}

Test.process (0, Template.TAdd (Template.TConst 1.0, Template.TVar "x"))
